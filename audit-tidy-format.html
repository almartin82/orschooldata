<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>orschooldata Enrollment Data Tidyness Audit • orschooldata</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="orschooldata Enrollment Data Tidyness Audit"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">orschooldata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/enrollment_hooks.html">15 Insights from Oregon School Enrollment Data</a></li>
    <li><a class="dropdown-item" href="articles/getting_started.html">Getting Started with orschooldata</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/almartin82/orschooldata"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>orschooldata Enrollment Data Tidyness Audit</h1>
      <small class="dont-index">Source: <a href="https://github.com/almartin82/orschooldata/blob/main/audit-tidy-format.md" class="external-link"><code>audit-tidy-format.md</code></a></small>
    </div>

<div id="orschooldata-enrollment-data-tidyness-audit" class="section level1">

<p><strong>Date:</strong> 2026-01-05 <strong>Auditor:</strong> Claude Code <strong>Package:</strong> orschooldata</p>
<hr><div class="section level2">
<h2 id="rating-310">Rating: 3/10<a class="anchor" aria-label="anchor" href="#rating-310"></a></h2>
<p>The package has serious issues preventing it from producing correct tidy format output.</p>
<hr></div>
<div class="section level2">
<h2 id="critical-issues">Critical Issues<a class="anchor" aria-label="anchor" href="#critical-issues"></a></h2>
<div class="section level3">
<h3 id="id_1-year-2023-2024-data-completely-broken-critical">1. <strong>Year 2023-2024 Data Completely Broken</strong> (CRITICAL)<a class="anchor" aria-label="anchor" href="#id_1-year-2023-2024-data-completely-broken-critical"></a></h3>
<p><strong>Problem:</strong> Years 2023 and 2024 return 0 rows of data.</p>
<p><strong>Root Cause:</strong> Year prefix pattern mismatch in <code><a href="reference/process_enr_era2.html">process_enr_era2()</a></code>.</p>
<p>The Oregon ODE changed their column naming convention: - <strong>Old pattern (2020-2022):</strong> <code>202122_grade_one</code> (6 digits: start_year % 100 + end_year) - <strong>New pattern (2023-2024):</strong> <code>202324_grade_one</code> (6 digits: start_year without leading century + end_year)</p>
<p>The code generates: - <code>year_prefix_long = "20232024"</code> (8 digits) - <strong>WRONG</strong> - <code>year_prefix_short = "2324"</code> (4 digits) - <strong>WRONG</strong></p>
<p>Expected for 2024: - Actual column name: <code>202324_grade_one</code> - Code looks for: <code>^2324_grade_one$</code> or <code>^20232024_grade_one$</code> - Neither pattern matches, so all grade columns are skipped</p>
<p><strong>Evidence:</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/fetch_enr.html">fetch_enr</a></span><span class="op">(</span><span class="fl">2024</span>, tidy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Returns: data.frame with 0 rows</span></span></code></pre></div>
<p><strong>Impact:</strong> Complete data loss for 2023-2024 school years.</p>
<hr></div>
<div class="section level3">
<h3 id="id_2-grade-level-data-not-extracted-all-years-critical">2. <strong>Grade-Level Data Not Extracted (ALL YEARS)</strong> (CRITICAL)<a class="anchor" aria-label="anchor" href="#id_2-grade-level-data-not-extracted-all-years-critical"></a></h3>
<p><strong>Problem:</strong> Grade-level breakdowns (K-12, PK, UG) are NOT included in tidy output.</p>
<p><strong>Expected:</strong> Each entity (state, district, campus) should have 15 grade_level rows: - TOTAL, PK, K, 01, 02, 03, 04, 05, 06, 07, 08, 09, 10, 11, 12, UG</p>
<p><strong>Actual:</strong> Only 1 row per entity with grade_level = “TOTAL”</p>
<p><strong>Evidence:</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_2022</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fetch_enr.html">fetch_enr</a></span><span class="op">(</span><span class="fl">2022</span>, tidy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">data_2022</span><span class="op">$</span><span class="va">grade_level</span><span class="op">)</span></span>
<span><span class="co"># TOTAL</span></span>
<span><span class="co">#  1649</span></span>
<span></span>
<span><span class="co"># Expected: 24,735 rows = 1649 entities * 15 grade_levels</span></span>
<span><span class="co"># Actual: 1,649 rows = 1649 entities * 1 grade_level (TOTAL only)</span></span></code></pre></div>
<p><strong>Root Cause:</strong> The <code><a href="reference/tidy_enr.html">tidy_enr()</a></code> function only creates: 1. A TOTAL row (from <code>row_total</code>) 2. Grade-level rows (from grade columns)</p>
<p>But since the grade columns aren’t being extracted from the raw Excel (due to pattern matching issues in process_enr_era2), only the TOTAL row exists.</p>
<p><strong>Raw Data Verification:</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Raw Excel files DO contain grade columns</span></span>
<span><span class="co"># 2022: "202122_kindergarten", "202122_grade_one", etc.</span></span>
<span><span class="co"># 2024: "202324_kindergarten", "202324_grade_one", etc.</span></span></code></pre></div>
<p>But <code><a href="reference/process_enr_era2.html">process_enr_era2()</a></code> doesn’t extract them because the year prefix patterns don’t match.</p>
<p><strong>Impact:</strong> Users cannot analyze enrollment trends by grade level. This is a core feature of school enrollment data.</p>
<hr></div>
<div class="section level3">
<h3 id="id_3-demographic-subgroups-not-extracted-critical">3. <strong>Demographic Subgroups Not Extracted</strong> (CRITICAL)<a class="anchor" aria-label="anchor" href="#id_3-demographic-subgroups-not-extracted-critical"></a></h3>
<p><strong>Problem:</strong> Oregon’s raw Excel files contain demographic breakdowns (race/ethnicity), but these are completely ignored.</p>
<p><strong>Evidence from 2024 raw Excel:</strong></p>
<pre><code><span><span class="st">"202324_american_indianalaska_native"</span></span>
<span><span class="st">"202324_asian"</span></span>
<span><span class="st">"202324_blackafrican_american"</span></span>
<span><span class="st">"202324_hispanic_latino"</span></span>
<span><span class="st">"202324_white"</span></span>
<span><span class="st">"202324_multiracial"</span></span>
<span><span class="st">"202324_native_hawaiian_pacific_islander"</span></span></code></pre>
<p><strong>Current output:</strong></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data_2022</span><span class="op">$</span><span class="va">subgroup</span><span class="op">)</span></span>
<span><span class="co"># [1] "total_enrollment"</span></span></code></pre></div>
<p><strong>Impact:</strong> Cannot analyze enrollment by race/ethnicity, which is critical for equity analyses.</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="secondary-issues">Secondary Issues<a class="anchor" aria-label="anchor" href="#secondary-issues"></a></h2>
<div class="section level3">
<h3 id="id_4-missing-pre-k-and-ungraded-data">4. <strong>Missing Pre-K and Ungraded Data</strong>
<a class="anchor" aria-label="anchor" href="#id_4-missing-pre-k-and-ungraded-data"></a></h3>
<p>Even if grade columns were extracted, the code looks for: - Pre-K patterns: <code>^202122_pre_k$</code>, <code>^202122_prek$</code>, etc. - Ungraded patterns: <code>^202122_ug$</code>, <code>^202122_ungraded$</code></p>
<p>But Oregon’s Excel files don’t use these column names. Pre-K data may not exist at all, and ungraded students likely aren’t tracked separately.</p>
<p><strong>Impact:</strong> Incomplete grade-level coverage if/when grade extraction is fixed.</p>
<hr></div>
<div class="section level3">
<h3 id="id_5-no-test-coverage-for-grade-level-data">5. <strong>No Test Coverage for Grade-Level Data</strong>
<a class="anchor" aria-label="anchor" href="#id_5-no-test-coverage-for-grade-level-data"></a></h3>
<p>Tests verify: - State total enrollment exists - Correct number of districts and campuses - Column names exist</p>
<p>But tests do NOT verify: - That grade-level breakdowns are present in tidy output - That grade sums match row totals - That specific grade values match raw data</p>
<p><strong>Impact:</strong> This major regression (missing all grade-level data) was not caught by tests.</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="data-completeness-analysis">Data Completeness Analysis<a class="anchor" aria-label="anchor" href="#data-completeness-analysis"></a></h2>
<div class="section level3">
<h3 id="working-years-2020-2022">Working Years (2020-2022)<a class="anchor" aria-label="anchor" href="#working-years-2020-2022"></a></h3>
<p>✅ <strong>State totals</strong>: Present and accurate ✅ <strong>District records</strong>: Correct count (~210) ✅ <strong>Campus records</strong>: Correct count (~1400) ❌ <strong>Grade-level breakdowns</strong>: Missing (only TOTAL grade_level) ❌ <strong>Demographic subgroups</strong>: Missing (only total_enrollment subgroup)</p>
</div>
<div class="section level3">
<h3 id="broken-years-2023-2024">Broken Years (2023-2024)<a class="anchor" aria-label="anchor" href="#broken-years-2023-2024"></a></h3>
<p>❌ <strong>Any data at all</strong>: 0 rows returned</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="target-format-comparison">Target Format Comparison<a class="anchor" aria-label="anchor" href="#target-format-comparison"></a></h2>
<div class="section level3">
<h3 id="expected-columns-from-alschooldata-standard">Expected Columns (from alschooldata standard):<a class="anchor" aria-label="anchor" href="#expected-columns-from-alschooldata-standard"></a></h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"end_year"</span>, <span class="st">"type"</span>, <span class="st">"district_id"</span>, <span class="st">"campus_id"</span>,</span>
<span>  <span class="st">"district_name"</span>, <span class="st">"campus_name"</span>, <span class="st">"county"</span>, <span class="st">"grade_level"</span>,</span>
<span>  <span class="st">"subgroup"</span>, <span class="st">"n_students"</span>, <span class="st">"pct"</span>,</span>
<span>  <span class="st">"is_state"</span>, <span class="st">"is_district"</span>, <span class="st">"is_campus"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="actual-columns-orschooldata">Actual Columns (orschooldata):<a class="anchor" aria-label="anchor" href="#actual-columns-orschooldata"></a></h3>
<p>✅ All expected columns present</p>
</div>
<div class="section level3">
<h3 id="expected-subgroups">Expected Subgroups:<a class="anchor" aria-label="anchor" href="#expected-subgroups"></a></h3>
<ul><li>total_enrollment</li>
<li>male, female (if available)</li>
<li>race/ethnicity subgroups (if available)</li>
</ul></div>
<div class="section level3">
<h3 id="actual-subgroups">Actual Subgroups:<a class="anchor" aria-label="anchor" href="#actual-subgroups"></a></h3>
<p>❌ Only “total_enrollment” (demographics exist in raw data but not extracted)</p>
</div>
<div class="section level3">
<h3 id="expected-grade-levels">Expected Grade Levels:<a class="anchor" aria-label="anchor" href="#expected-grade-levels"></a></h3>
<ul><li>TOTAL, PK, K, 01, 02, 03, 04, 05, 06, 07, 08, 09, 10, 11, 12, UG</li>
</ul></div>
<div class="section level3">
<h3 id="actual-grade-levels">Actual Grade Levels:<a class="anchor" aria-label="anchor" href="#actual-grade-levels"></a></h3>
<p>❌ Only “TOTAL” (grade columns exist in raw data but not extracted)</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="required-fixes">Required Fixes<a class="anchor" aria-label="anchor" href="#required-fixes"></a></h2>
<div class="section level3">
<h3 id="fix-1-correct-year-prefix-calculation-critical">Fix 1: Correct Year Prefix Calculation (CRITICAL)<a class="anchor" aria-label="anchor" href="#fix-1-correct-year-prefix-calculation-critical"></a></h3>
<p><strong>File:</strong> <code>R/process_enrollment.R</code></p>
<p><strong>Function:</strong> <code><a href="reference/process_enr_era2.html">process_enr_era2()</a></code></p>
<p><strong>Current code (line 244-245):</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_prefix_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">start_year</span>, <span class="va">end_year</span><span class="op">)</span>  <span class="co"># "20232024" - WRONG</span></span>
<span><span class="va">year_prefix_short</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">start_year</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">end_year</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>  <span class="co"># "2324" - WRONG</span></span></code></pre></div>
<p><strong>Fix for 2023-2024 pattern:</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Oregon uses 6-digit format: start_year_without_century + end_year</span></span>
<span><span class="co"># Example: 2023-24 becomes "202324" (not "2324" and not "20232024")</span></span>
<span><span class="va">year_prefix_6digit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">start_year</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, <span class="va">end_year</span><span class="op">)</span>  <span class="co"># "232024" -&gt; wait, this is still wrong</span></span>
<span></span>
<span><span class="co"># Actually need: start_year % 100 (gives 23 for 2023) + end_year (gives 24)</span></span>
<span><span class="va">year_prefix_correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">start_year</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">100</span>, <span class="va">end_year</span><span class="op">)</span>  <span class="co"># "2324" for 2023-24</span></span>
<span></span>
<span><span class="co"># But wait, 2024 uses "202324", not "2324"</span></span>
<span><span class="co"># Let me recalculate: 202324 = "2023" truncated + "2024"</span></span>
<span><span class="co"># That's: substr(start_year, 1, 4) gives "2023", then paste with "24"</span></span>
<span><span class="co"># No wait, "202324" has 6 digits: 2023 + 24</span></span>
<span><span class="va">year_prefix_6digit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">start_year</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">end_year</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># For 2024: "2023" + "24" = "202324" ✓</span></span>
<span><span class="co"># For 2023: "2022" + "23" = "202223" ✓</span></span>
<span><span class="co"># For 2022: "2021" + "22" = "202122" ✓</span></span></code></pre></div>
<p><strong>Wait, let me verify:</strong> - 2022 data: columns are <code>202122_*</code> ✓ (matches “2021” + “22”) - 2023 data: columns are <code>202223_*</code> ✓ (matches “2022” + “23”) - 2024 data: columns are <code>202324_*</code> ✓ (matches “2023” + “24”)</p>
<p><strong>Correct fix:</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Line ~244 in process_enr_era2()</span></span>
<span><span class="va">year_prefix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">start_year</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">end_year</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Results: "202122", "202223", "202324" (6 digits)</span></span>
<span></span>
<span><span class="co"># Then update all grade patterns to use this:</span></span>
<span><span class="va">patterns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"^"</span>, <span class="va">year_prefix</span>, <span class="st">"_grade_"</span>, <span class="va">word</span>, <span class="st">"$"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"grade_"</span>, <span class="va">word</span>, <span class="st">"$"</span><span class="op">)</span>,</span>
<span>  <span class="co"># ... fallback patterns</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fix-2-extract-demographic-subgroups-high-priority">Fix 2: Extract Demographic Subgroups (HIGH PRIORITY)<a class="anchor" aria-label="anchor" href="#fix-2-extract-demographic-subgroups-high-priority"></a></h3>
<p><strong>File:</strong> <code>R/process_enrollment.R</code></p>
<p><strong>New function needed:</strong> Extract race/ethnicity columns from raw data</p>
<p>Oregon Excel files have these demographic columns: - <code>202324_american_indianalaska_native</code> - <code>202324_asian</code> - <code>202324_blackafrican_american</code> - <code>202324_hispanic_latino</code> - <code>202324_white</code> - <code>202324_multiracial</code> - <code>202324_native_hawaiian_pacific_islander</code></p>
<p>These need to be: 1. Extracted in <code><a href="reference/process_enr_era2.html">process_enr_era2()</a></code> (similar to grade columns) 2. Added to wide format as separate columns 3. Pivoted to long format in <code><a href="reference/tidy_enr.html">tidy_enr()</a></code> as additional subgroup rows</p>
</div>
<div class="section level3">
<h3 id="fix-3-add-grade-level-fidelity-tests-high-priority">Fix 3: Add Grade-Level Fidelity Tests (HIGH PRIORITY)<a class="anchor" aria-label="anchor" href="#fix-3-add-grade-level-fidelity-tests-high-priority"></a></h3>
<p><strong>File:</strong> <code>tests/testthat/test-enrollment.R</code></p>
<p>Add tests to verify:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"grade-level breakdowns exist in tidy output"</span>, <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fetch_enr.html">fetch_enr</a></span><span class="op">(</span><span class="fl">2022</span>, tidy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Each campus should have multiple grade_levels</span></span>
<span>  <span class="va">campus_grades</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">is_campus</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="va">campus_id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">pull</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">campus_grades</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>             info <span class="op">=</span> <span class="st">"Each campus should have multiple grade_level rows"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">test_that</span><span class="op">(</span><span class="st">"grade sums match row_total"</span>, <span class="op">{</span></span>
<span>  <span class="va">wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fetch_enr.html">fetch_enr</a></span><span class="op">(</span><span class="fl">2022</span>, tidy<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># For each campus, sum of grades should equal row_total</span></span>
<span>  <span class="va">grade_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grade_k"</span>, <span class="st">"grade_01"</span>, <span class="va">...</span>, <span class="st">"grade_12"</span><span class="op">)</span></span>
<span>  <span class="co"># Verify: sum(grade_cols) == row_total (within tolerance)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a></h2>
<p><strong>Current State:</strong> - Years 2020-2022: Partially working (state/district/campus totals only) - Years 2023-2024: Completely broken (0 rows)</p>
<p><strong>Missing Critical Features:</strong> 1. Grade-level breakdowns (K-12) 2. Demographic subgroups (race/ethnicity)</p>
<p><strong>Root Cause:</strong> Year prefix pattern matching fails to extract grade and demographic columns from raw Excel files.</p>
<p><strong>Recommendation:</strong> This is a <strong>3/10</strong> rating because while the infrastructure is in place, the core data extraction is broken for recent years and missing grade-level detail for all years. The package needs significant fixes to match the target tidy format used by other state packages.</p>
<hr></div>
<div class="section level2">
<h2 id="files-requiring-changes">Files Requiring Changes<a class="anchor" aria-label="anchor" href="#files-requiring-changes"></a></h2>
<ol style="list-style-type: decimal"><li>
<strong>R/process_enrollment.R</strong>
<ul><li>Fix year prefix calculation (line ~244)</li>
<li>Add grade column extraction verification</li>
<li>Add demographic column extraction</li>
</ul></li>
<li>
<strong>tests/testthat/test-enrollment.R</strong>
<ul><li>Add grade-level coverage tests</li>
<li>Add demographic subgroup tests</li>
<li>Add raw data fidelity tests for grades</li>
</ul></li>
<li>
<strong>R/tidy_enrollment.R</strong>
<ul><li>Consider adding demographic subgroup pivoting (if implemented in process)</li>
</ul></li>
</ol></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Al Martin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

